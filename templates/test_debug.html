<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片显示调试</title>
    <style>
        .debug-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .image-test {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
        .image-test img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
        }
        .test-info {
            margin: 10px 0;
            font-family: monospace;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>图片显示调试页面</h1>
        
        <div class="image-test">
            <h3>测试1：最新生成的原始图片</h3>
            <div class="test-info">URL: /uploads/nano_banana_text_1760891731.png</div>
            <img src="/uploads/nano_banana_text_1760891731.png" alt="原始图片" id="original-img">
        </div>
        
        <div class="image-test">
            <h3>测试2：第一次调整后的图片</h3>
            <div class="test-info">URL: /uploads/nano_banana_text_1760891731_adjusted_1760891803.png</div>
            <img src="/uploads/nano_banana_text_1760891731_adjusted_1760891803.png" alt="调整后图片1" id="adjusted1-img">
        </div>
        
        <div class="image-test">
            <h3>测试3：第二次调整后的图片（最终图片）</h3>
            <div class="test-info">URL: /uploads/nano_banana_text_1760891731_adjusted_1760891803_adjusted_1760891825.png</div>
            <img src="/uploads/nano_banana_text_1760891731_adjusted_1760891803_adjusted_1760891825.png" alt="调整后图片2" id="adjusted2-img">
        </div>
        
        <div class="image-test">
            <h3>测试4：模拟final-image元素</h3>
            <div class="test-info">使用与create.html相同的CSS类</div>
            <div class="image-preview-container">
                <img id="final-image-test" src="" alt="最终确认的图片">
            </div>
            <button onclick="setFinalImage()">设置最终图片</button>
            <button onclick="checkFinalImage()">检查图片状态</button>
        </div>
        
        <div id="debug-log"></div>
    </div>

    <script>
        let currentImageUrl = '/uploads/nano_banana_text_1760891731_adjusted_1760891803_adjusted_1760891825.png';
        
        function setFinalImage() {
            const img = document.getElementById('final-image-test');
            img.src = currentImageUrl;
            img.style.display = 'block';
            
            logDebug('设置final-image src: ' + currentImageUrl);
            
            img.onload = () => logDebug('✅ 图片加载成功');
            img.onerror = () => logDebug('❌ 图片加载失败');
        }
        
        function checkFinalImage() {
            const img = document.getElementById('final-image-test');
            logDebug('图片元素检查:');
            logDebug('- src: ' + img.src);
            logDebug('- display: ' + img.style.display);
            logDebug('- naturalWidth: ' + img.naturalWidth);
            logDebug('- naturalHeight: ' + img.naturalHeight);
        }
        
        function logDebug(message) {
            const log = document.getElementById('debug-log');
            log.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }
        
        // 页面加载时检查所有图片
        window.onload = function() {
            logDebug('=== 页面加载完成，开始检查图片 ===');
            
            ['original-img', 'adjusted1-img', 'adjusted2-img'].forEach(id => {
                const img = document.getElementById(id);
                img.onload = () => logDebug(`✅ ${id} 加载成功`);
                img.onerror = () => logDebug(`❌ ${id} 加载失败`);
            });
        };
    </script>
</body>
</html>