<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI创作工坊 - 开始创作</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <i class="fas fa-magic"></i>
                <span>AI创意工坊</span>
            </div>
            <ul class="nav-menu">
                <li><a href="{{ url_for('index') }}" class="nav-link">首页</a></li>
                <li><a href="/create" class="nav-link active">开始创作</a></li>
                <li><a href="/gallery" class="nav-link">作品展示</a></li>
                <li><a href="/tutorial" class="nav-link">使用教程</a></li>
            </ul>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <main class="main-content create-page">
        <div class="container">
            <!-- 创作进度指示器 -->
            <div class="creation-progress">
                <div class="progress-step active" id="step-1">
                    <div class="step-number">1</div>
                    <span>创作输入</span>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" id="step-2">
                    <div class="step-number">2</div>
                    <span>图片生成</span>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" id="step-3">
                    <div class="step-number">3</div>
                    <span>调整优化</span>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" id="step-4">
                    <div class="step-number">4</div>
                    <span>3D模型</span>
                </div>
            </div>

            <!-- 创作工作区 -->
            <div class="creation-workspace">
                <!-- 第一步：创作输入 -->
                <div id="input-stage" class="creation-stage active">
                    <div class="stage-header">
                        <h2><i class="fas fa-lightbulb"></i> 描述你的创意</h2>
                        <p>用文字描述你的想法，或上传线稿图片作为参考</p>
                    </div>

                    <div class="creation-input-area">
                        <div class="prompt-input-container">
                            <div class="input-wrapper">
                                <textarea 
                                    id="creation-prompt" 
                                    class="creation-input" 
                                    placeholder="例如：一只可爱的小猫咪，戴着红色的帽子，坐在彩虹上...&#10;&#10;你可以只用文字描述，也可以上传图片作为参考！"
                                    rows="4"
                                ></textarea>
                                <button class="add-image-btn" onclick="triggerImageUpload()" title="上传参考图片">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <input type="file" id="reference-image" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            </div>
                            <div class="input-hint">
                                💡 <strong>创作小贴士：</strong>可以描述颜色、形状、表情、背景等细节，或上传线稿图片
                            </div>
                        </div>

                        <!-- 上传的图片预览 -->
                        <div id="uploaded-image-preview" class="image-preview" style="display: none;">
                            <div class="preview-header">
                                <span><i class="fas fa-image"></i> 参考图片</span>
                                <button class="remove-image-btn" onclick="removeUploadedImage()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <img id="uploaded-image" src="" alt="上传的参考图片">
                        </div>
                        
                        <div class="generation-options">
                            <div class="option-group">
                                <label>图片风格：</label>
                                <select id="image-style" class="style-select">
                                    <option value="cute">可爱卡通</option>
                                    <option value="realistic">写实风格</option>
                                    <option value="anime">动漫风格</option>
                                    <option value="fantasy">奇幻风格</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label>色彩偏好：</label>
                                <select id="color-preference" class="style-select">
                                    <option value="colorful">色彩丰富</option>
                                    <option value="pastel">柔和色调</option>
                                    <option value="bright">明亮鲜艳</option>
                                    <option value="natural">自然色彩</option>
                                </select>
                            </div>
                        </div>
                        
                        <button id="generate-image" class="generate-btn">
                            <i class="fas fa-wand-magic-sparkles"></i>
                            生成图片
                        </button>
                    </div>
                </div>

                <!-- 第二步：生成结果 -->
                <div id="generation-stage" class="creation-stage">
                    <div class="stage-header">
                        <h2><i class="fas fa-image"></i> AI生成结果</h2>
                        <p>查看AI为你生成的图片，你可以重新生成或进行调整</p>
                    </div>

                    <div class="generated-image-container">
                        <img id="generated-image" src="" alt="AI生成的图片">
                        <div class="image-actions">
                            <button class="action-btn regenerate-btn" onclick="regenerateImage()">
                                <i class="fas fa-redo"></i>
                                重新生成
                            </button>
                            <button class="action-btn adjust-btn" onclick="showAdjustPanel()">
                                <i class="fas fa-sliders-h"></i>
                                调整图片
                            </button>
                            <button class="action-btn confirm-btn" onclick="confirmImage()">
                                <i class="fas fa-check"></i>
                                确认图片
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 第三步：调整阶段 -->
                <div id="adjustment-stage" class="creation-stage">
                    <div class="stage-header">
                        <h2><i class="fas fa-edit"></i> 图片调整</h2>
                        <p>告诉AI你希望如何调整图片</p>
                    </div>

                    <div class="adjustment-workspace">
                        <div class="current-image">
                            <h4>当前图片</h4>
                            <img id="current-image" src="" alt="当前图片">
                        </div>

                        <div class="adjust-panel">
                            <h4><i class="fas fa-edit"></i> 调整提示</h4>
                            <textarea 
                                id="adjustment-prompt" 
                                class="adjustment-input" 
                                placeholder="例如：让颜色更鲜艳一些，改变背景为森林..."
                                rows="3"
                            ></textarea>
                            <div class="adjust-actions">
                                <button class="apply-adjust-btn" onclick="applyAdjustment()">
                                    <i class="fas fa-check"></i>
                                    应用调整
                                </button>
                                <button class="cancel-adjust-btn" onclick="skipAdjustment()">
                                    <i class="fas fa-arrow-right"></i>
                                    跳过调整
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第四步：3D模型生成 -->
                <div id="model-stage" class="creation-stage">
                    <div class="stage-header">
                        <h2><i class="fas fa-cube"></i> 3D模型生成</h2>
                        <p>基于你的图片生成3D模型</p>
                    </div>

                    <div class="model-generation-area">
                        <div class="final-image-preview">
                            <h4>最终图片</h4>
                            <img id="final-image" src="" alt="最终确认的图片">
                        </div>

                        <div class="model-generation-panel">
                            <div class="generation-info">
                                <i class="fas fa-info-circle"></i>
                                <p>3D模型生成需要一些时间，请耐心等待...</p>
                            </div>
                            
                            <button id="generate-3d" class="generate-btn">
                                <i class="fas fa-cube"></i>
                                生成3D模型
                            </button>

                            <!-- 3D模型预览区域 -->
                            <div id="model-preview-area" style="display: none;">
                                <h4>3D模型预览</h4>
                                <div class="model-container" id="modelContainer">
                                    <div class="model-placeholder">
                                        <i class="fas fa-cube"></i>
                                        <p>3D模型加载中...</p>
                                    </div>
                                </div>
                                <div class="model-controls">
                                    <button class="control-btn" id="rotateModel">
                                        <i class="fas fa-sync-alt"></i>
                                        自动旋转
                                    </button>
                                    <button class="download-btn" id="download3D">
                                        <i class="fas fa-download"></i>
                                        下载3D模型
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 完成操作 -->
                    <div class="final-actions" style="display: none;" id="final-actions">
                        <button class="download-btn" onclick="downloadImage()">
                            <i class="fas fa-download"></i>
                            下载图片
                        </button>
                        <button class="secondary-btn" onclick="startNewCreation()">
                            <i class="fas fa-plus"></i>
                            创建新作品
                        </button>
                        <button class="primary-btn" onclick="shareCreation()">
                            <i class="fas fa-share"></i>
                            分享我的创作
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 加载覆盖层 -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">AI正在创作中...</div>
            <div class="loading-subtitle">请稍等片刻，好作品值得等待 ✨</div>
        </div>
    </div>

    <!-- 消息提示 -->
    <div id="message-toast" class="message-toast"></div>

    <!-- Three.js库用于3D模型展示 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- 创作页面JavaScript -->
    <script src="{{ url_for('static', filename='js/create.js') }}"></script>
</body>
</html>