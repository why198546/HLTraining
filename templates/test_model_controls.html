<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D模型控制面板测试</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/loaders/GLTFLoader.js"></script>
</head>
<body>
    <div class="container">
        <h1>3D模型控制面板测试</h1>
        
        <!-- 测试按钮 -->
        <div class="test-controls">
            <button onclick="createTestModel()" class="btn">创建测试模型</button>
            <button onclick="checkModelViewer()" class="btn">检查ModelViewer状态</button>
        </div>
        
        <!-- 3D模型显示区域 -->
        <div class="model-overlay" id="modelOverlay" style="display: block;">
            <div class="model-overlay-content">
                <canvas id="modelCanvas" width="800" height="600" style="border: 1px solid #ccc;"></canvas>
                
                <!-- 控制面板 -->
                <div class="model-controls-panel">
                    <!-- 显示控制 -->
                    <div class="controls-section">
                        <h4><i class="fas fa-eye"></i> 显示控制</h4>
                        <div class="model-controls">
                            <button class="model-btn" onclick="rotateModel()">
                                <i class="fas fa-redo"></i> 旋转
                            </button>
                            <button class="model-btn" onclick="resetView()">
                                <i class="fas fa-home"></i> 重置
                            </button>
                            <button class="model-btn" onclick="toggleWireframe()">
                                <i class="fas fa-border-none"></i> 线框
                            </button>
                            <button class="model-btn" onclick="togglePointCloud()">
                                <i class="fas fa-braille"></i> 点云
                            </button>
                        </div>
                    </div>

                    <!-- 材质设置 -->
                    <div class="controls-section">
                        <h4><i class="fas fa-palette"></i> 材质设置</h4>
                        <div class="model-controls">
                            <button class="model-btn" onclick="switchMaterial('original')">
                                <i class="fas fa-gem"></i> 原始
                            </button>
                            <button class="model-btn" onclick="switchMaterial('lambert')">
                                <i class="fas fa-circle"></i> 朗伯
                            </button>
                            <button class="model-btn" onclick="switchMaterial('phong')">
                                <i class="fas fa-sun"></i> 冯氏
                            </button>
                            <button class="model-btn" onclick="switchMaterial('standard')">
                                <i class="fas fa-star"></i> 标准
                            </button>
                        </div>
                    </div>

                    <!-- 环境设置 -->
                    <div class="controls-section">
                        <h4><i class="fas fa-globe"></i> 环境设置</h4>
                        <div class="model-controls">
                            <button class="model-btn" onclick="toggleBackground()">
                                <i class="fas fa-image"></i> 背景
                            </button>
                        </div>
                    </div>

                    <!-- 关闭按钮 -->
                    <div class="controls-section">
                        <div class="model-controls">
                            <button class="model-btn close-btn" onclick="closeModelViewer()">
                                <i class="fas fa-times"></i> 关闭
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 模型信息显示 -->
                <div id="modelInfo" style="position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px;">
                    准备加载测试模型...
                </div>
            </div>
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="{{ url_for('static', filename='js/model-viewer-3d.js') }}"></script>
    
    <script>
        let modelViewer = null;

        // 创建测试模型
        function createTestModel() {
            const canvas = document.getElementById('modelCanvas');
            const modelInfo = document.getElementById('modelInfo');
            
            if (!canvas) {
                console.error('找不到画布元素');
                return;
            }

            try {
                // 初始化ModelViewer3D
                modelViewer = new ModelViewer3D(canvas);
                console.log('ModelViewer3D创建成功:', modelViewer);
                
                // 创建测试立方体
                const testModel = modelViewer.createTestCube();
                console.log('测试模型创建成功:', testModel);
                
                modelInfo.textContent = '测试模型已加载 - 使用鼠标拖拽旋转，滚轮缩放';
                
            } catch (error) {
                console.error('创建测试模型失败:', error);
                modelInfo.textContent = '创建测试模型失败: ' + error.message;
            }
        }

        // 检查ModelViewer状态
        function checkModelViewer() {
            console.log('当前ModelViewer状态:');
            console.log('- modelViewer 对象:', modelViewer);
            if (modelViewer) {
                console.log('- scene:', modelViewer.scene);
                console.log('- camera:', modelViewer.camera);
                console.log('- renderer:', modelViewer.renderer);
                console.log('- controls:', modelViewer.controls);
                console.log('- model:', modelViewer.model);
                console.log('- 可用方法:', Object.getOwnPropertyNames(Object.getPrototypeOf(modelViewer)));
            }
            
            // 检查Three.js是否加载
            console.log('Three.js 状态:', typeof THREE !== 'undefined' ? 'loaded' : 'not loaded');
            
            const modelInfo = document.getElementById('modelInfo');
            if (modelInfo) {
                modelInfo.textContent = '检查控制台输出以查看状态信息';
            }
        }

        // 关闭模型查看器
        function closeModelViewer() {
            const overlay = document.getElementById('modelOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            
            if (modelViewer) {
                // 清理资源
                modelViewer.dispose && modelViewer.dispose();
                modelViewer = null;
            }
        }

        // 页面加载完成后自动创建测试模型
        window.addEventListener('load', function() {
            setTimeout(createTestModel, 1000);
        });
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-controls {
            margin-bottom: 20px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .model-overlay {
            position: relative;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            padding: 20px;
        }
        
        .model-overlay-content {
            position: relative;
        }
        
        #modelCanvas {
            display: block;
            margin: 0 auto;
            background: #333;
        }
    </style>
</body>
</html>